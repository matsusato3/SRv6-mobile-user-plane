<?xml version="1.0" encoding="US-ASCII"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY rfc2119 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY rfc5213 SYSTEM
    "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5213.xml">
<!ENTITY I-D.ietf-spring-segment-routing SYSTEM
    "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-spring-segment-routing.xml">
<!ENTITY I-D.filsfils-spring-srv6-network-programming SYSTEM
    "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.filsfils-spring-srv6-network-programming.xml">
<!ENTITY I-D.ietf-dmm-fpc-cpdp SYSTEM
    "http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-dmm-fpc-cpdp.xml">

]>
<?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>

<rfc category="std" docName="draft-matsushima-spring-dmm-srv6-mobile-uplane-03"
     ipr="trust200902">
  <?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?>

  <?rfc toc="yes" ?>

  <?rfc symrefs="yes" ?>

  <?rfc sortrefs="yes"?>
  <?rfc compact="yes" ?>
  <?rfc subcompact="yes" ?>
  <?rfc iprnotified="no" ?>

  <?rfc strict="yes" ?>

  <front>
    <title abbrev="SRv6-mobile-uplane">Segment Routing IPv6 for Mobile User-Plane</title>

     <author fullname="Satoru Matsushima" initials="S." surname="Matsushima">
      <organization abbrev="SoftBank">SoftBank</organization>

      <address>
        <postal>
          <street></street>
          <city>Tokyo</city>
          <region></region>
          <code></code>
          <country>Japan</country>
        </postal>
        <email>satoru.matsushima@g.softbank.co.jp</email>
      </address>
    </author>
    
    <author fullname="Clarence Filsfils" initials="C." surname="Filsfils">
      <organization abbrev="Cisco Systems, Inc.">Cisco Systems, Inc.</organization>
      <address>
        <postal>
          <street></street>
          <city></city>
          <region></region>
          <code></code>
          <country>Belgium</country>
        </postal>
        <email>cf@cisco.com</email>
      </address>
    </author>

    <author fullname="Miya Kohno" initials="M." surname="Kohno">
      <organization abbrev="Cisco Systems, Inc.">Cisco Systems, Inc.</organization>
      <address>
        <postal>
          <street></street>
          <city></city>
          <region></region>
          <code></code>
          <country>Japan</country>
        </postal>
        <email>mkohno@cisco.com</email>
      </address>
    </author>

    <author fullname="Daniel Voyer" initials="D." surname="Voyer">
      <organization abbrev="Bell Canada">Bell Canada</organization>
      <address>
        <postal>
          <street></street>
          <city></city>
          <region></region>
          <code></code>
          <country>Canada</country>
        </postal>
        <email>daniel.voyer@bell.ca</email>
      </address>
    </author>

    <date year="2017" />

    <workgroup>SPRING and DMM</workgroup>

    <abstract>

      <t>This document discusses the applicability of SRv6 (Segment Routing
      IPv6) to user-plane of mobile networks that SRv6 source routing
      capability with its programmability can fulfill the user-plane
      functions, such as access and anchor functions. It takes advantage of
      underlying layer awareness and flexibility to deploy user-plane
      functions that enables optimizing data-path for applications. Network
      slicing and an interworking way between SRv6 and existing mobile
      user-plane are also discussed in this document. </t>

    </abstract>
  </front>

  <middle>
    <section title="Introduction">

        <t>In mobile networks, mobility management systems provide
        connectivity while mobile nodes move around. While the
        control-plane of the system signals movements of a mobile node,
        user-plane establishes tunnel between the mobile node and anchor
        node over IP based backhaul and core networks. </t>

        <t>This document discusses the applicability of SRv6 (Segment
        Routing IPv6) to those mobile networks. SRv6 provides source
        routing to networks where operators can explicitly indicate route
        for the packets from and to the mobile node. SRv6 endpoint nodes
        act as roles of anchor of mobile user-plane. </t>

    </section>

    <section title="Conventions and Terminology">
        <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <xref
        target="RFC2119"></xref>.</t>
        
        <t>All segment routing and SRv6 network programming terms are
        defined in <xref target="I-D.ietf-spring-segment-routing"/> and
        "<xref target="I-D.filsfils-spring-srv6-network-programming"/>.</t>

    </section>


    <section anchor="motivations" title="Motivations">
    
        <t>Today's and future applications are requiring highly optimized
        data-path between mobile nodes and the entities of those
        applications in perspectives of latency, bandwidth, etc,. However
        current architecture of mobile management is agnostic about
        underlying topologies of transport layer. It rigidly fragments the
        user-plane in radio access, core and service networks and connects
        them by tunneling techniques through the user-plane functions such
        as access and anchor nodes. Those agnostic and rigidness make it
        difficult for the operator to optimize the data-path.</t>
    
        <t>While the mobile network industry has been trying to solve that,
        applications shift to use IPv6 data-path and network operators
        adopt it as their IP transport as well. SRv6 integrates both
        application data-path and underlying transport layer in data-path
        optimization aspects that does not require any other techniques.</t>
        
        <t>SRv6 source routing capability with programmable functions <xref
        target="I-D.filsfils-spring-srv6-network-programming"/> could
        fulfills the user-plane functions of mobility management.  It takes
        advantage of underlying layer awareness and flexibility to deploy
        user-plane functions. Those are the motivations to adopt SRv6 for
        mobile user-plane.</t>

    
    </section>
    
    <section anchor="uplane" title="Mobile User-Plane">
        <t>This section describes user-plane using SRv6 for mobile
        networks. This clarifies mobile user-plane functions to which SRv6
        endpoint applied.</t>
        
        <t><xref target="fig_srv6-uplane"/> shows mobile user-plane
        functions which are connected through IPv6-only networks.
        In the <xref target="fig_srv6-uplane"/>, an mobile node (MN)
        connects to an SRv6 endpoint serving access point role for the MN.
        When the endpoint receives packets from the MN, it pushes SRH to
        the packets. The segment list in the SRH indicates the rest of
        user-plane segments which are L2 and L3 anchors respectively. Then
        the endpoint send the packets to the IPv6 network. In
        opposite direction, when an SRv6 endpoint serving L3 anchor role
        for the MN receives packets to it, the endpoint push SRH consist of
        the L2 anchor and access point segments to the packets.</t>

        <t>
            <figure anchor="fig_srv6-uplane" title="Mobile User-plane with SRv6">
            <artwork align="center"><![CDATA[

                               User-plane                            
                               Function                              
                              <L2 Anchor>                            
                               O------O                              
                               | SRv6 |                              
                               | End  |                              
                               | Point|                              
                               O------O                              
             User-plane           ||           User-plane            
   [MN]      Function        _____||_____      Function             
     |     <Access Point>   /            \    <L3 Anchor>            
  ___v___     O------O     /              \     O------O     ________
 /  Radio \   | SRv6 |    /                \    | SRv6 |    /        \ 
/  Access  \==| End  |===/     IPv6-Only    \===| End  |===/ Service  \
\    NW    /  | Point|   \      Network     /   | Point|   \    NW    /
 \________/   O------O    \                /    O------O    \________/ 
                           \              /                             
                            \____________/                            

              ]]></artwork>
            <postamble></postamble>
          </figure>
        </t>
        
        <t>An SRv6 segment represents those each function, such as Access
        Point, Layer-2 (L2) Anchor and Layer-3 (L3) Anchor. This makes
        mobile networks highly flexible to deploy any user-plane functions
        to which nodes in user flow basis. An SRv6 segment can represent a
        set of flows in any granularity of aggregation even though it is
        just for a single flow.</t>
        
        <t><xref target="fig_interwork"/> shows that an SRv6 endpoint connects
        existing IPv4 mobile user-plane, which is defined in <xref
        target="RFC5213"/> and <xref target="TS.29281"/>. An SRv6 segment
        in the endpoint represents interworking function which enables
        interworking between existing access point and SRv6 anchor segment,
        or SRv6 access point segment and existing anchor node.</t>
        
        <t>Existing mobile user-plane with IPv6 underlay is expected to be
        widely deployed. As IPv6 network should be interoperable with SRv6
        endpoints can be accommodated on it, interworking with existing
        IPv6 network is out of scope of this document.</t>

        <t>
            <figure anchor="fig_interwork" 
            title=" Interworking with Existing Mobile Networks">
            <artwork align="center"><![CDATA[

    ________                                                 _______  
   /        \    O------O                                   /       \ 
  / Service  \===|L2/L3 |                                  / Service \
  \    NW    /   |Anchor|         User-plane               \    NW   /
   \________/    |Node  |         Function                  \_______/ 
                 O------O       <Interworking>                  ||    
                     \\_______     O------O     ________     O------O 
                     /        \    | SRv6 |    /        \    | SRv6 | 
                    / Existing \===| End  |===/ IPv6-Only\===| End  | 
                    \  IPv4 NW /   | Point|   \  Network /   | Point| 
      [MN]           \________/    O------O    \________/    O------O 
       |             //                                         ||    
    ___v____    O------O                                     ___||__  
   / Radio  \   |Access|                                    / Radio  \ 
  /  Access  \==|Point |                            [MN]~~~/  Access  \
  \    NW    /  |Node  |                                   \    NW    /
   \________/   O------O                                    \________/ 
         
         
         
         
              ]]></artwork>
            <postamble></postamble>
          </figure>
        </t>
        
        <t>The detail of SRv6 segments representing user-plane functions
        are described in <xref target="uplane-functions"/>. </t>
    
    </section>

    <section anchor="uplane-functions" title="Supporting Mobile User-Plane Functions">
    
        <t>This section describes mobile user-plane functions to which an SRv6
        node can apply SRv6 functions and behaviors. The SRv6 node 
        configured with those segments thereby fulfills the user-plane functions.
        Each function consist of two segments which are uplink (UL) from
        mobile node to the correspondent node, and downlink (DL) from the
        correspondent node to mobile node. </t>
        
        <t>An SRv6 node may be configured with multiple type of user-plane
        functions. Each function may also be configured with multiple sets
        of the segments for one type of function that to purpose of
        separating tenants, resources and service policies, etc. </t>
        
        <section anchor="ap_func" title="Access Point">

            <t>Access Point function provides SRv6 node the
            role to which mobile node is connected directly.
            eNodeB could be referenced as an entity
            implementing the access point in 3GPP term.</t>
            
            <t>When an SRv6 node is configured for an Access Point
            function, the SRv6 node allocates one DL access-point segment
            SID per session, or per Access Point function which represents
            one policy that is shared by multiple sessions.</t>
            
            <t>Applicable SRv6 functions and behaviors are determined by
            use cases described in <xref target="SRv6_funct"/>.</t>
        
        </section>

        <section anchor="l2anchor_func" title="Layer-2 Anchor">

            <t>Layer-2 anchor function provides SRv6 node
            the role to be anchor point while mobile node move
            around within a serving area which could be assumed
            as a layer-2 network. Serving Gateway (SGW) could
            be referenced as an entity implementing the layer-2
            anchor in 3GPP term.</t>

            <t>When an SRv6 node is configured for a Layer-2 anchor
            function, the SRv6 node allocates one UL L2-anchor segment SID
            which represents an SRv6 policy, i.e., next L3-anchor function
            and specific service if needed. The SRv6 node also allocates
            one DL L2-anchor segment SID which represents an SRv6 policy,
            i.e., serving access point SID and specific service if
            needed.</t>

            <t>Applicable SRv6 functions and behaviors are determined by
            use cases described in <xref target="SRv6_funct"/>.</t>

        </section>

        <section anchor="l3anchor_func" title="Layer-3 Anchor">

            <t>Layer-3 anchor function provides SRv6 node
            the role to be anchor point across a mobile network
            consists of multiple serving areas. Packet data
            network gateway (PGW) could be referenced as an
            entity implementing the layer-3 anchor.</t>

            <t>When an SRv6 node is configured for a Layer-3 Anchor function,
            the SRv6 node allocates one UL L3-anchor segment SID per
            L3-anchor function. Each L3-anchor SID
            represents one policy which is shared by multiple sessions,
            such as a routing table, or a service policy with in the table.
            The routing table should maintain forwarding entries of the 
            belonging MNs.</t>

            <t>Applicable SRv6 functions and behaviors are determined by
            use cases described in <xref target="SRv6_funct"/>.</t>

        </section>


        <section anchor="stateless_iw_func" title="Stateless Interworking">
        
            <t>Stateless interworking function provides SRv6 node a role
            to interworking between existing mobile user-plane and SRv6
            mobile user-plane. <xref target="fig_interwork-sid"/> shows the
            SRv6 SID format for stateless interworking function that is
            encoding identifiers of corresponding tunnel in existing
            network as argument of the SID. </t>
            
            <t>
                <figure anchor="fig_interwork-sid" 
                title="Stateless Interworking SID Encoding">
                <artwork align="center"><![CDATA[

+----------------------+-------+-------+-------+
|    IW-IPv6-Prefix    |IPv4DA |IPv4SA |TUN-ID |
+----------------------+-------+-------+-------+
        128-a-b-c          a      b       c

                  ]]></artwork>
                <postamble></postamble>
              </figure>
            </t>
            

            <t>Stateless interworking function introduce following 
            SRv6 end function and transit behavior. </t>

            <t>
                <list style="hanging" hangIndent="24">
                    <t hangText="End.TM: ">End point function with encapsulation for mapped tunnel</t>
                    <t hangText="T.Tmap: ">Transit behavior with tunnel decapsulation and mapping an SRv6 Policy</t>
                </list>
            </t>
            
            
            <t>Stateless interworking function is associated with the
           following mandatory parameters:</t>
           
            <t><list style="hanging" hangIndent="24">
                <t hangText="IW-IPv4-Prefix: ">IPv4 prefix representing network of
                SRv6 user-plane for legacy mobile user-plane</t>
                <t hangText="IW-IPv6-Prefix: ">IPv6 prefix representing network of
                legacy mobile user-plane for SRv6 user-plane</t>
                <t hangText="TUN-PROTO: ">Tunnel protocol type, such as GTP-U or
                GRE for PMIP</t>
            </list></t>
 
            
            <section anchor="end.tm" title="End.TM: End point function with encapsulation for mapped tunnel">
            
                <t>The "End point to encapsulate for mapped tunnel" function (End.TM for short)
                is used to the direction from SRv6 user-plane to legacy user-plane network.</t>
            
                <t> When interworking node N receives a packet destined to S and S is a local
                End.TM SID, N does:</t>

                <figure><artwork align="left"><![CDATA[
1. IF NH=SRH & SL > 0 THEN                   
2.    decrement SL                               
3.    update the IPv6 DA with SRH[SL]            
4.    push header of TUN-PROTO with tunnel ID from S            ;; Ref1
5.    push outer IPv4 header with SA, DA from S  
6. ELSE                                          
7.    Drop the packet                            
                  ]]></artwork></figure>

                <t>Ref1: TUN-PROTO indicates target tunnel type.</t>

 
                    
            </section>
            
            <section anchor="T.Tmap" title="T.Tmap: Transit behavior with tunnel decapsulation and mapping an SRv6 Policy">
            
                <t>The "Transit with tunnel decapsulation and map to an
                SRv6 policy" function (T.Tmap for short) is used to the
                direction from legacy user-plane to SRv6 user-plane
                network.</t>


                <t>When interworking node N receives a packet destined to a IW-IPv4-Prefix,  N does:</t>
   
                <figure><artwork align="left"><![CDATA[
1.   IF P.PLOAD == TUN-PROTO & T.PLOAD == IPv6 THEN    ;; Ref1, Ref1bis
2.      pop the outer IPv4 header and tunnel headers                   
3.      copy IPv4 DA, SA, TUN-ID to form SID B with IW-IPv6-Prefix     
4.      insert the SRH (D, B; SL=1)                    ;; Ref2, Ref2bis
5.      set the IPv6 DA = B                                            
6.      forward along the shortest path to B                           
7.   ELSE                                                              
8.      Drop the packet                                                
                  ]]></artwork></figure>
                
                <t>Ref1: P.PLOAD and T.PLOAD represent payload protocol of
                the receiving packet, and payload protocol of the tunnel
                respectively.</t>

                <t>Ref1bis: First nibble of payload is used to determine
                payload protocol in GTP-U case due to it has no payload
                protocol indicator in the header.</t>

                <t>Ref2: The received IPv6 DA is placed as last SID of the inserted SRH.</t>

                <t>Ref2bis: The SRH is inserted before any other IPv6 Routing Extension
                Header.</t>


            </section>

<!--                
                    <t>In case of IPv4 flow packet over the user-plane, the
                    endpoint does IPv6 header encaps and decaps instead of SRH
                    insert and pop process. The IPv6 header includes
                    interworking segment SID in the SRH.</t>
                
                    <t>Noted that to make sure stateless interworking, entities
                    of control-plane in mobile management should cooperate with
                    SRv6 user-plane settings. Further control-plane
                    consideration is discussed in <xref target="c-plane"/>.</t>
                    
                   It is
            expected that the endpoint of interworking segment
            could be unaware from the control-plane of the
            mobility management. While there are combinations
            of interworking either existing or SRv6 network in
            which user-plane functions accommodate,
            interworking segment should cover all combinations
            without mobility state.</t>
-->
 

        </section>

        <section anchor="rate-limit" title="Rate Limit">
    
            <t>Mobile user-plane requires rate-limit feature. SID is
            able to encode limiting rate as an argument in SID.
            Multiple flows of packets should have same group identifier
            in SID when those flows are in an same AMBR group. This
            helps to keep user-plane stateless. That enables SRv6
            endpoint nodes which are unaware from the mobile
            control-plane information. Encoding format of rate limit
            segment SID is following:</t>

            <t>
                <figure anchor="fig_ratelimit-sid" 
                title="Stateless Interworking SID Encoding">
                <artwork align="center"><![CDATA[

+----------------------+----------+-----------+
| Locater of rate-limit| group-id | limit-rate|
+----------------------+----------+-----------+
          128-i-j            i          j

                  ]]></artwork>
                <postamble></postamble>
              </figure>
            </t>
            
            <t>In case of j bit length is zero in SID, the node should
            not do rate limiting unless static configuration or
            control-plane sets the limit rate associated to the
            SID. </t>

        </section>
        
        
    </section>
        
    <section anchor="SRv6_funct" title="Segment Routing IPv6 Functions and Behaviors by Use Cases">
        
            <t> This section describes SRv6 functions and behavior applied
           to mobile user-plane functions by use cases. Terminology of SRv6
           endpoint functions refers to <xref
           target="I-D.filsfils-spring-srv6-network-programming"/>. </t>
           
           <section anchor="basic_mode" title="Basic Mode">
            
                    <t>In the basic mode, we assume that mobile user-plane
                    functions are as same as existing ones except using
                    SRv6. This means that there is no impact to rest part
                    of mobile system should be expected while no advanced
                    segment routing features are introduced to it.</t>
                    
                    <texttable anchor="basic_mode_table" title="SRv6 Functions for Basic Mode">
                        <ttcol align="left">User-plane Function</ttcol>
                        <ttcol align="center">Uplink</ttcol>
                        <ttcol align="center">Downlink</ttcol>
                        <c>Access Point</c><c>T.Insert</c><c>End.X</c>
                        <c>L2-anchor</c>   <c>End.B6</c><c>End.B6</c>
                        <c>L3-anchor</c>   <c>End.T</c><c>T.Insert</c>
                    </texttable>
                    
                    <section anchor="basic_ul" title="Uplink">
                        <t>In uplink, SRv6 node applies following SRv6 end
                        point functions and transit behavior. SIDs are
                        allocated per L3-anchor function in the SRv6 nodes of
                        both L2 and L3-anchor functions in basic mode.</t>

                        <t>
                            <list style="hanging">
                                <t hangText="Access Point:">
                                    <list>
                                        <t>When the access point node receives a packet
                                        destine to "D::1" from a mobile node "S::1", it
                                        does T.Insert process for the receiving packets to
                                        push a SRH with SID list &lt;A2::1, D::1&gt; with SL=1.
                                        The access point node update DA to next UL L2-anchor 
                                        SID "A2::1" which the SL indicates and forward the packet. </t>
                                    </list><vspace />
                                </t>
                                <t hangText="Layer-2 Anchor:">
                                    <list>
                                        <t>The L2-anchor node of "A2::1" segment does
                                        End.B6 process for the receiving packet according
                                        to the SRH. The node updates DA to next UL L3-anchor
                                        SID "A3::1" bound to "A2::1" and forward the packet.
                                        In this basic use case, just one UL L3-anchor SID with SL=0 is
                                        enough to do it so that there is no need
                                        to push another SRH to the packet in that PSP
                                        (Penultimate Segment Pop) operation. </t>
                                    </list><vspace />
                                </t>
                                <t hangText="Layer-3 Anchor:">
                                    <list>
                                        <t>The L3-anchor node of "A3::1" segment does End.T
                                        process for the receiving packet according to the
                                        SRH. The node decrement SL to 0, updates DA to D::1 
                                        which the SL indicates and lookup IPv6 table associated with "A3::1". In
                                        this basic use case, the decremented SL is 0 so that
                                        the node does PSP operation of popped out the SRH
                                        from the packet and forward it. </t>
                                    </list>
                                </t>
                            </list>
                        </t>
                                                
                        
                        
                    </section>
                        
                    <section anchor="basic_dl" title="Downlink">
                        <t>In downlink, SRv6 node applies following SRv6
                        end point functions and transit behavior. SIDs are
                        allocated per session in the SRv6 nodes of both
                        L2-anchor and access point functions in basic
                        mode.</t>

                        <t>
                            <list style="hanging">
                                <t hangText="Layer-3 Anchor:">
                                    <list>
                                        <t>When the L3-anchor node receives a packet
                                        destine to "S::1" from a correspondent node "D::1", it
                                        does T.Insert process for the receiving packets to
                                        push a SRH with SID list &lt;A2::2, S::1&gt; with SL=1.
                                        The L3-anchor node update DA to next DL L2-anchor SID "A2::2" which the SL
                                        indicates and forward the packet. </t>
                                    </list><vspace />
                                </t>
                                <t hangText="Layer-2 Anchor:">
                                    <list>
                                        <t>The L2-anchor node of "A2::2" segment does
                                        End.B6 process for the receiving packet according
                                        to the SRH. The node updates DA to next DL access point
                                        segment "A1::1" bound to "A2::2" and forward the packet. In this
                                        basic use case, just one DL access point SID with SL=0 is
                                        enough to do it so that there is no need
                                        to push another SRH to the packet in that PSP
                                        (Penultimate Segment Pop) operation. </t>
                                    </list><vspace />
                                </t>
                                <t hangText="Access Point:">
                                    <list>
                                        <t>The access point node of "A1::1" segment does
                                        End.X process for the receiving packet according to
                                        the segment. The node decrement SL to 0, updates DA to S::1
                                        which the SL indicates and forward the packet to the mobile node 
                                        of "S::1" through radio channel associated with "A1::1". In this
                                        use case, the decremented SL is 0 so that the node does
                                        PSP operation of popped out the SRH from the packet and 
                                        forward it. </t>
                                    </list>
                                </t>
                            </list>
                        </t>
                        
                        
                        

                    </section>
    
                </section>

           <section anchor="aggregate_mode" title="Aggregate Mode">
            
                <t>In the aggregate mode, user-plane function is able to
                steer multiple mobile sessions per service policy. This
                means that mobile sessions paths are aggregated into a
                service path which includes not only mobile user-plane
                functions but also other nodes, links or service
                functions. SIDs are allocated per service policy in the
                SRv6 nodes of user-plane functions in the aggregate
                mode.</t>
                    
                <texttable anchor="aggragate_mode_table" title="SRv6 Functions for Aggregate Mode">
                    <ttcol align="left">User-plane Function</ttcol>
                    <ttcol align="center">Uplink</ttcol>
                    <ttcol align="center">Downlink</ttcol>
                    <c>Access Point</c><c>T.Insert</c><c>End</c>
                    <c>L2-anchor</c>   <c>End or End.B6</c><c>End or End.B6</c>
                    <c>L3-anchor</c>   <c>End.T</c><c>T.Insert</c>
                </texttable>
                    
                    <section anchor="aggregate_ul" title="Uplink">
                        <t>In uplink, SRv6 node applies following SRv6 end point functions
                        and transit behavior. </t>

                        <t>
                            <list style="hanging">
                                <t hangText="Access Point:">
                                    <list>
                                        <t>When the access point node receives a packet
                                        destine to "D::1" from a mobile node "S::1", it
                                        does T.Insert process for the receiving packets.
                                        The service policy for "D::1" is via service function S1
                                        and node C1 before reach to L2-anchor "A2::1" so that the node
                                        pushes a SRH with SID list &lt;S1, C1, A2::1, D::1&gt; with SL=3.
                                        The node updates DA to service function S1
                                        which the SL indicates and forward the packet. </t>
                                    </list>
                                    <list>
                                        <t>In case of the access point function
                                        directly indicates the path beyond the
                                        L2-anchor, service function S2 and
                                        L3-anchor "A3::1" for example, the SID list
                                        shoud be &lt;S1, C1, A2::, S2, A3::1, D::1&gt;
                                        with SL=5.</t>
                                    </list><vspace />
                                </t>
                                <t hangText="Layer-2 Anchor:">
                                    <list>
                                        <t>In case of the L2-anchor node of "A2::1" segment is 
                                        bound to a service policy which indicates path via 
                                        service function S2 and L3-anchor function A3::1, the node
                                        does End.B6 process for the receiving packet to push a new
                                        SRH with SID list &lt;S2, A3::1&gt; with SL=1. 
                                        The node updates DA to next service function SID 
                                        S2 which the SL indicates and forward the packet.</t>
                                    </list>
                                    <list>
                                        <t>In case of one SRH with SIDs &lt;S1, C1, A2::,
                                        S2, A3::1, D::1&gt;, the L2-anchor node of "A2::" segment
                                        is bound to just End function. The node does
                                        End process for the receiving packet according to
                                        the SRH that decrements SL to 2, updates DA to
                                        next service function SID S2 which the SL
                                        indicates and forward the packet. </t>
                                    </list>
                                    <list>
                                        <t>It is assumed that the packet successfully
                                        traversed S1 and C1 segments so that the SL
                                        was decremented 3 to 1 in the End.B6 case, and 
                                        5 to 3 in the End case before arriving the node 
                                        of "A2::1" or "A2::" segment.</t>
                                    </list><vspace />
                                </t>
                                <t hangText="Layer-3 Anchor:">
                                    <list>
                                        <t>The L3-anchor node of "A3::1" segment does
                                        End.T process for the receiving packet according
                                        to the SRH(s). In case of outer SRH with SIDs
                                        &lt;S2, A3::1&gt;, it is assumed that the SL is
                                        decremented to 0 at service function S2 so that
                                        the node pops outer SRH. Then the node processes
                                        second SRH with SIDs &lt;S1, C1, A2::1, D::1&gt; that 
                                        decrements SL to 0, updates DA to D::1 which the SL 
                                        indicates and lookup IPv6 table associated with "A3::1". 
                                        In this case, the decremented SL is 0 so that the node
                                        does PSP operation of popped out the SRH from the
                                        packet and forward it. </t>
                                    </list>
                                    <list>
                                        <t>In case of one SRH with SIDs &lt;S1, C1, A2::,
                                        S2, A3::1, D::1&gt;, L3-anchor node of "A3::"
                                        segment does End.T process for the receiving
                                        packet according to the SRH. Rest part of processes 
                                        are as same as previous case. </t>
                                    </list>
                                </t>
                            </list>
                        </t>


                    </section>
                        
                    <section anchor="aggregate_dl" title="Downlink">                        
                        <t>In downlink, SRv6 node applies following SRv6 end point functions
                        and transit behavior.</t>

                        <t>
                            <list style="hanging">
                                <t hangText="Layer-3 Anchor:">
                                    <list>
                                        <t>When the L3-anchor node receives a packet
                                        destine to "S::1" from a mobile node "D::1", it
                                        does T.Insert process for the receiving packets.
                                        The service policy for "S::1" is via service function S2
                                        before reach to L2-anchor "A2::2" so that the node
                                        pushes a SRH with SID list &lt;S2, A2::2, S::1&gt; with SL=2.
                                        The node updates DA to service function S2
                                        which the SL indicates and forward the packet. </t>
                                    </list>
                                    <list>
                                        <t>In case of the L3-anchor function
                                        directly indicates the path beyond the
                                        L2-anchor, service function S1, node C3 and
                                        access point "A1::" for example, the SID list
                                        shoud be &lt;S2, A2::, S1, C1, A1::1, D::1&gt;
                                        with SL=5.</t>
                                    </list><vspace />
                                </t>
                                <t hangText="Layer-2 Anchor:">
                                    <list>
                                        <t>In case of the L2-anchor node of "A2::2" segment is 
                                        bound to a service policy which indicates path via node C1,
                                        service function S1 and access point function A1::, the node
                                        does End.B6 process for the receiving packet to push a new
                                        SRH with SID list &lt;C1, S1, A1::1&gt; with SL=1. 
                                        The node updates DA to next service function SID 
                                        C1 which the SL indicates and forward the packet.</t>
                                    </list>
                                    <list>
                                        <t>In case of one SRH with SIDs &lt;S1, C1, A2::,
                                        S2, A3::1, D::1&gt;, the L2-anchor node of "A2::" segment
                                        is bound to just End function. The node does
                                        End process for the receiving packet according to
                                        the SRH that decrements SL to 2, updates DA to
                                        next node C1 which the SL
                                        indicates and forward the packet. </t>
                                    </list>
                                    <list>
                                        <t>It is assumed that the packet successfully
                                        traversed S2 segment so that the SL
                                        was decremented 2 to 1 in the End.B6 case, and 
                                        5 to 4 in the End case before arriving the node 
                                        of "A2::2" or "A2::" segment.</t>
                                    </list><vspace />
                                </t>
                                <t hangText="Access Point:">
                                    <list>
                                        <t>The access point node of "A1::1" segment does
                                        End process for the receiving packet according
                                        to the SRH(s). In case of outer SRH with SIDs
                                        &lt;C1, S1, A1::1&gt;, it is assumed that the SL is
                                        decremented 2 to 0 at node C1 and service function S1 so that
                                        the outer SRH is popped out by PSP at S1. Thus the node processes
                                        second SRH with SIDs &lt;S2, A2::2, S::1&gt; that 
                                        decrements SL to 0, updates DA to S::1 which the SL 
                                        indicates and forward the packet to the mobile node
                                        through radio channel associated with "S::1".
                                        In this case, the decremented SL is 0 so that the node
                                        does PSP operation of popped out the SRH from the
                                        packet and forward it. </t>
                                    </list>
                                    <list>
                                        <t>In case of one SRH with SIDs &lt;S2, A2::, C1,
                                        S1, A1::1, S::1&gt;, access node of "A1::1"
                                        segment does End process for the receiving
                                        packet according to the SRH. Rest part of processes 
                                        are as same as previous case.</t>
                                    </list>
                                </t>
                            </list>
                        </t>

                    </section>
    
                </section>

                <section anchor="stateless-iwf-access" title="Stateless Interworking with Legacy Access Network">

                    <t>This section describes an use case where user-plane
                    functions are interworking in stateless between SRv6
                    and legacy access networks. Here stateless means that
                    there's no need to be aware any states of mobility
                    sessions in the node. </t>
                    
                    <t>As some types of interworking scenarios could be
                    considered, we will describe other cases in the future
                    versions of this document.</t>
                    
                    <section title="Uplink: Lagacy Access to SRv6">
                        
                        <t><list style="hanging">
                            <t hangText="Legacy Access Point:">
                                <list>
                                    <t>When a legacy access point node
                                    receives a packet destined to "D::1"
                                    from a mobile node "S::1" through
                                    associated radio channel, it does
                                    tunnel encapsulation with the tunneling
                                    parameters, IPv4 DA, SA and tunnel
                                    header with ID, and sends out the
                                    packet to the network. </t>
                                </list>
                            </t>
                        </list></t>

                        <t><list style="hanging">
                            <t hangText="Stateless Interworking:">
                                <list>
                                    <t>The stateless interworking node of
                                    corresponding to the IPv4 DA does
                                    T.Tmap process for the receiving packet
                                    to pop the tunnel headers and push a
                                    SRH to the packet. The SRH consists of SIDs &lt;B1,
                                    D::1&gt; with SL=1, where "B1" encodes
                                    IW-IPv6-Prefix, tunnel IPv4 DA, SA and
                                    TUN-ID in it as <xref
                                    target="fig_interwork-sid"/> defined.
                                    The stateless interworking node updates
                                    DA to "B1" and forward the packet. 
                                    SA of the packet must be kept as "S::1".</t>
                                </list>
                            </t>
                        </list></t>
                        
                        <t><list style="hanging">
                            <t hangText="Layer-2 or Layer-3 Anchor:">
                                <list>
                                    <t>The receiving node of the packet destine to B1
                                    would be Layer-2 anchor, or Layer-3 anchor node.
                                    Which type of anchor function is bound to 
                                    B1 depends on operational policy.</t>
                                </list>
                                <list>
                                    <t>In case of B1 to an L2-anchor node,
                                    the L2-anchor node does End.B6 process
                                    for the receiving packet as same as
                                    previous section.</t>
                                </list>
                                <list>
                                    <t>In case of B1 to an L3-anchor node,
                                    the L3-anchor node does End.T process
                                    for the receiving packet as same as
                                    previous section.</t>
                                </list>
                            </t>
                        </list></t>

                    </section>
                    
                    <section title="Downlink: SRv6 to Legacy Access">

                        <t><list style="hanging">
                            <t hangText="Layer-2 or Layer-3 Anchor:">
                                <list>
                                    <t>In case of an L3-anchor node
                                    receives a packet destine to S::1 from the
                                    correspondent node "D::1", and
                                    stateless interworking SID is bound to
                                    the next segment of S::1 , the
                                    L3-anchor node does T.Insert process
                                    for the receiving packet to push a SRH
                                    with SID list &lt;B2::, S::1&gt; with
                                    SL=1, where "B2" which encodes
                                    IW-IPv6-Prefix, tunnel IPv4 DA, SA and
                                    TUN-ID in it as <xref
                                    target="fig_interwork-sid"/> defined.
                                    The L3-anchor node updates DA to "B2"
                                    and forward the packet.</t>
                                </list>
                                <list>
                                    <t>In case of an L2-anchor node receives a packet
                                    destine to SID "A2::B2" and the SID is bound to "B2",
                                    the L2-anchor node does End.B6 process
                                    for the receiving packet as same as
                                    previous section. The node updates DA to
                                    B2 and forward the packet.</t>
                                </list>
                            </t>
                        </list></t>

                        <t><list style="hanging">
                            <t hangText="Stateless Interworking:">
                                <list>
                                    <t>The stateless interworking node of
                                    "B2" End.TM process for the receiving
                                    packet according to the SRH. The node
                                    decrement SL to 0, updates DA to "D::1"
                                    which the SL indicates, push IPv4 and
                                    tunnel headers with IPv4 DA, SA and
                                    TUN-ID extracted from "B2", and forward
                                    the packet to the legacy network. </t>
                                </list>
                                <list>
                                    <t> In this use case, decremented SL is
                                    0 so that the node does PSP operation
                                    of popped out the SRH from the packet
                                    and forward it.</t>
                                </list>
                            </t>
                        </list></t>
                        
                        <t><list style="hanging">
                            <t hangText="Legacy Access Point:">
                                <list>
                                    <t> The legacy access point node of the
                                    IPv4 DA does tunnel termination process
                                    for the receiving packet according to
                                    the tunnel header. The node pop the
                                    IPv4 and tunnel header and forward the
                                    packet to the mobile node through radio
                                    channel associated with the tunnel.</t>
                                </list>
                            </t>
                        </list></t>
                    
                    </section>

                </section>

        </section>

    


    <section anchor="netslice" title="Network Slicing Considerations">
    
        <t>Mobile network may be required to create a network slicing that
        represent a set of network resources and isolate those resource
        from other slices. User-plane functions represented as SRv6
        segments would be part of a slice.</t>
        
        <t>To represent a set of user-plane function segments for a slice,
        sharing same prefix through those SIDs within the slice could be a
        straightforward way. SIDs in a network slice may include other type
        of functions in addition to the mobile user-plane functions
        described in this document, and underlay integration to meet SLA and
        quality requirements.</t>
        
        <t>While network slicing has been discussed in the IETF and other
        standardization bodies, what functionalities are required for
        network slicing in mobile user-plane is further study item and to
        be discussed.</t>

    </section>


    <section anchor="c-plane" title="Control Plane Considerations">
    
        <section anchor="existing-cplane" title="Existing Control Plane">
    
            <t>A mobile control-plane entity may allocate SIDs to the node
            of corresponding user-plane function. In this case, the
            control-plane entity must signal allocated SIDs to other side
            of entity. </t>
        
            <t>If the control-plane entity needs to employ existing mobile
            control-plane protocol to signal, GTP-C or PMIP for example, it must require
            not to impact the control-plane protocols. In this case, tunnel endpoint IPv6
            address field in the control-plane message can be used to signal a SID. In this way,
            there is no impact to the control-plane with the basic mode described in 
            <xref target="basic_mode"/>.</t>
            
            <!--
            <xref
            target="table_cplane-mode"/> shows applicable user-plane
            function segments for that restriction.</t>
        
            <texttable anchor="table_cplane-mode" title="Applicable SRv6 User-Plane for Existing Control-Plane">
                <ttcol align="left">User-plane Function</ttcol>
                <ttcol align="center">Basic Mode</ttcol>
                <ttcol align="center">Aggregate Mode</ttcol>
                <c>UL access point to L2-anchor</c>   <c>X</c><c> </c>
                <c>UL L2-anchor to L3-anchor</c>      <c>X</c><c>X</c>
                <c>DL L3-anchor to L2-anchor</c>      <c>X</c><c> </c>
                <c>DL L2-anchor to access point</c>   <c>X</c><c> </c>
            </texttable>
            
            -->

            <t>To support aggregate mode described in <xref target="aggregate_mode"/>
            in existing control-plane protocol, allocated SIDs for service policies can be
            signaled as tunnel endpoint IPv6 address too. Aggregate mode user-plane can take
            advantage of SRv6 that enables seamless mobile user-plane deployment with
            service chaining, VPNs, traffic-engineering by computed path to fulfil the policy.</t>
        
        </section>
        
        <section anchor="cups" title="User-Plane Sepalated Control Plane">

            <t>In an user-plane separated control-plane system, a mobile
            user-plane entity may allocate SIDs to an user-plane function
            instead of the control-plane. In this case, the user-plane
            entity should inform allocated SIDs back to the control-plane
            entity.</t>

            <t>If the control- and user-plane entities need to employ
            existing user-plane control protocol in between, such as PFCP
            for example, it may be required not to impact that protocol. In
            this case, the control-plane entity is only allowed to signal
            SID in a tunnel endpoint IPv6 address field. </t>

        </section>
        
        <section anchor="centralize-sdn" title="Centralized Controller">

            <t>When a centralized controller interfaces to mobile
            control-planes is capable to allocate SIDs to the controlling SRv6
            nodes, the mobile control-planes just need to indicate 
            nodes and their user-plane functions to the controller. In
            this case, the controller must allocate appropriate SIDs for the
            user-plane functions to the SRv6 nodes. The controller
            must configure allocated SIDs to the nodes. To build centralized controller 
            for mobile user-plane is out of scope of this document.</t>
        
            <t>However, to indicate nodes and their user-plane functions from mobile
            control-plane to user-plane, the centralized controller could
            take advantage of <xref target="I-D.ietf-dmm-fpc-cpdp"/>. It
            provides interface to the control-plane to manage the user-plane of
            mobile networks.</t>

        </section>
        
        <section anchor="iwf-cplane" title="Stateless Interworking">
        
            <t>A mobile control-plane is not required to configure statless interworking
            function in interworking node. This benefits operators to gradually migrate
            from legacy to advanced mobile user-plane with no impact to the legacy system.</t>
        
            <t>SID allocating entity of SRv6 user-plane nodes needs to be aware of
            IW-IPv6-Prefix to form interworking SID. The mobile control-plane of legacy
            user-plane also need to allocate IPv4 addresses which represent tunnel
            endpoints in the SRv6 user-plane to be mapped to SIDs.</t>
        
        </section>
        
    </section>
    

    <section title="Security Considerations">
    
        <t>TBD</t>
    
    </section>

    <section anchor="IANA" title="IANA Considerations">
    
        <t>This document has no actions for IANA.</t>
    
    </section>

    <section anchor="acknowledge" title="Acknowledgements">
    
        <t>TBD
<!--        
        The authors would like to thank Daisuke Yokota,  Bart Peirens,
        Ryokichi Onishi and Kentaro Ebisawa for their useful comments of
        this work. -->
        </t>
    
    </section>

  </middle>

  <back>
    <references title="Normative References">
        &rfc2119;
        &I-D.ietf-spring-segment-routing;
        &I-D.filsfils-spring-srv6-network-programming;
    </references>

    <references title="Informative References">
        &I-D.ietf-dmm-fpc-cpdp;
        &rfc5213;
        <reference anchor="TS.29281">
            <front>
                <title>General Packet Radio System (GPRS) Tunnelling
                Protocol User Plane (GTPv1-U)</title>
                <author surname="3GPP" fullname="3GPP">
                </author>
                <date month="September" year="2011" />
            </front>
            <seriesInfo name="3GPP TS 29.281" value="10.3.0" />
        </reference>
    </references>


  </back>
</rfc>
